<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vite | Zeno Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/zeno-blog/icons/favicon.ico">
    <link rel="manifest" href="/zeno-blog/manifest.json">
    <link rel="apple-touch-icon" href="/zeno-blog/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/zeno-blog/icons/safari-pinned-tab.svg" color="#000000">
    <meta name="description" content="You cannot find peace by avoiding life.">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/zeno-blog/assets/css/0.styles.2a2e5ad3.css" as="style"><link rel="preload" href="/zeno-blog/assets/js/app.baaaf02d.js" as="script"><link rel="preload" href="/zeno-blog/assets/js/3.3b039ebf.js" as="script"><link rel="preload" href="/zeno-blog/assets/js/1.8ae41a42.js" as="script"><link rel="preload" href="/zeno-blog/assets/js/28.3912919e.js" as="script"><link rel="preload" href="/zeno-blog/assets/js/9.54de9460.js" as="script"><link rel="prefetch" href="/zeno-blog/assets/js/10.d23ac256.js"><link rel="prefetch" href="/zeno-blog/assets/js/11.5a7a5198.js"><link rel="prefetch" href="/zeno-blog/assets/js/12.97804d64.js"><link rel="prefetch" href="/zeno-blog/assets/js/13.4dc120e1.js"><link rel="prefetch" href="/zeno-blog/assets/js/14.c1a00834.js"><link rel="prefetch" href="/zeno-blog/assets/js/15.4a2b3824.js"><link rel="prefetch" href="/zeno-blog/assets/js/16.e24f2f2f.js"><link rel="prefetch" href="/zeno-blog/assets/js/17.9664ebb4.js"><link rel="prefetch" href="/zeno-blog/assets/js/18.83e5c9e0.js"><link rel="prefetch" href="/zeno-blog/assets/js/19.9b5b61cf.js"><link rel="prefetch" href="/zeno-blog/assets/js/20.ab477e1d.js"><link rel="prefetch" href="/zeno-blog/assets/js/21.e8a35783.js"><link rel="prefetch" href="/zeno-blog/assets/js/22.fee4f00c.js"><link rel="prefetch" href="/zeno-blog/assets/js/23.af321c9f.js"><link rel="prefetch" href="/zeno-blog/assets/js/24.f172a350.js"><link rel="prefetch" href="/zeno-blog/assets/js/25.a8a68f50.js"><link rel="prefetch" href="/zeno-blog/assets/js/26.fe9fff6b.js"><link rel="prefetch" href="/zeno-blog/assets/js/27.99317524.js"><link rel="prefetch" href="/zeno-blog/assets/js/29.63e0fad7.js"><link rel="prefetch" href="/zeno-blog/assets/js/30.ab692565.js"><link rel="prefetch" href="/zeno-blog/assets/js/31.8413c69a.js"><link rel="prefetch" href="/zeno-blog/assets/js/32.a3afd322.js"><link rel="prefetch" href="/zeno-blog/assets/js/33.5f1528bf.js"><link rel="prefetch" href="/zeno-blog/assets/js/34.ccc7f69a.js"><link rel="prefetch" href="/zeno-blog/assets/js/35.f22c0190.js"><link rel="prefetch" href="/zeno-blog/assets/js/36.e521d96f.js"><link rel="prefetch" href="/zeno-blog/assets/js/37.b10530ae.js"><link rel="prefetch" href="/zeno-blog/assets/js/4.fb2513d9.js"><link rel="prefetch" href="/zeno-blog/assets/js/5.76a1324f.js"><link rel="prefetch" href="/zeno-blog/assets/js/6.a28c1884.js"><link rel="prefetch" href="/zeno-blog/assets/js/7.aa3ab8d4.js"><link rel="prefetch" href="/zeno-blog/assets/js/8.e45da13b.js">
    <link rel="stylesheet" href="/zeno-blog/assets/css/0.styles.2a2e5ad3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-19557b78><div data-v-19557b78><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-19557b78 data-v-19557b78><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-19557b78 data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Zeno Blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Zeno</span>
            
          <span data-v-64685f0e>2019 - </span>
          2024
        </a></span></div></div> <div class="hide" data-v-19557b78><header class="navbar" data-v-19557b78><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zeno-blog/" class="home-link router-link-active"><img src="/zeno-blog/images/head.jpg" alt="Zeno Blog" class="logo"> <span class="site-name">Zeno Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zeno-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Nginx/" class="nav-link"><i class="iconfont undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/NestJS/" class="nav-link"><i class="iconfont undefined"></i>
  NestJS
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Tools/" class="nav-link"><i class="iconfont undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/其他/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Vite/" class="nav-link"><i class="iconfont undefined"></i>
  Vite
</a></li></ul></div></div><div class="nav-item"><a href="/zeno-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/zeno-blog/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-19557b78></div> <aside class="sidebar" data-v-19557b78><div class="personal-info-wrapper" data-v-042e23d4><img src="/zeno-blog/images/head.jpg" alt="author-avatar" class="personal-img" data-v-042e23d4> <h3 class="name" data-v-042e23d4>
    Zeno
  </h3> <div class="num" data-v-042e23d4><div data-v-042e23d4><h3 data-v-042e23d4>26</h3> <h6 data-v-042e23d4>Article</h6></div> <div data-v-042e23d4><h3 data-v-042e23d4>9</h3> <h6 data-v-042e23d4>Tag</h6></div></div> <hr data-v-042e23d4></div> <nav class="nav-links"><div class="nav-item"><a href="/zeno-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Nginx/" class="nav-link"><i class="iconfont undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/NestJS/" class="nav-link"><i class="iconfont undefined"></i>
  NestJS
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Tools/" class="nav-link"><i class="iconfont undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/其他/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/zeno-blog/categories/Vite/" class="nav-link"><i class="iconfont undefined"></i>
  Vite
</a></li></ul></div></div><div class="nav-item"><a href="/zeno-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/zeno-blog/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zeno-blog/views/vite/vite.html#什么是构建工具" class="sidebar-link">什么是构建工具</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#webpack与vite的区别" class="sidebar-link">Webpack与Vite的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite的简单例子" class="sidebar-link">vite的简单例子</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#依赖预构建" class="sidebar-link">依赖预构建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite配置文件格式" class="sidebar-link">Vite配置文件格式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#基础格式" class="sidebar-link">基础格式</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#生产测试环境" class="sidebar-link">生产测试环境</a></li></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite环境变量" class="sidebar-link">Vite环境变量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite的路径别名配置" class="sidebar-link">Vite的路径别名配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite的devserver原理" class="sidebar-link">Vite的DevServer原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#devserver简单实现" class="sidebar-link">DevServer简单实现</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#devserver的配置" class="sidebar-link">DevServer的配置</a></li></ul></li><li><a href="/zeno-blog/views/vite/vite.html#关于静态资源的引入" class="sidebar-link">关于静态资源的引入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#前提" class="sidebar-link">前提</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#后续" class="sidebar-link">后续</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#注意" class="sidebar-link">注意</a></li></ul></li><li><a href="/zeno-blog/views/vite/vite.html#静态资源：css" class="sidebar-link">静态资源：CSS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#引入css的原理" class="sidebar-link">引入CSS的原理</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#css-module" class="sidebar-link">CSS Module</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#预处理器（less、scss）" class="sidebar-link">预处理器（less、scss）</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#postcss" class="sidebar-link">postcss</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#css-in-js" class="sidebar-link">CSS In JS</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#css原子化框架" class="sidebar-link">CSS原子化框架</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#css相关配置" class="sidebar-link">CSS相关配置</a></li></ul></li><li><a href="/zeno-blog/views/vite/vite.html#静态资源：svg" class="sidebar-link">静态资源：SVG</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#打包配置" class="sidebar-link">打包配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite库配置" class="sidebar-link">Vite库配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite处理跨域问题" class="sidebar-link">Vite处理跨域问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite插件（待补充）" class="sidebar-link">Vite插件（待补充）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#插件设计" class="sidebar-link">插件设计</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#vite-plugin-html插件" class="sidebar-link">vite-plugin-html插件</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#vite-aliases插件" class="sidebar-link">vite-aliases插件</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#vite-plugin-mock插件" class="sidebar-link">vite-plugin-mock插件</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#console消除插件（待补充）" class="sidebar-link">console消除插件（待补充）</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#打包后静态资源自动上传cdn插件（待补充）" class="sidebar-link">打包后静态资源自动上传cdn插件（待补充）</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#console徽章" class="sidebar-link">console徽章</a></li></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite集成ts" class="sidebar-link">Vite集成TS</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zeno-blog/views/vite/vite.html#vite性能优化" class="sidebar-link">Vite性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#分包策略" class="sidebar-link">分包策略</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#多入口" class="sidebar-link">多入口</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#gzip压缩" class="sidebar-link">gzip压缩</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#动态导入" class="sidebar-link">动态导入</a></li><li class="sidebar-sub-header"><a href="/zeno-blog/views/vite/vite.html#cdn加速" class="sidebar-link">CDN加速</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Vite</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Zeno</span>
            
          <span data-v-64685f0e>2019 - </span>
          2024
        </a></span></div></div> <div data-v-19557b78><main class="page"><div class="page-title" style="display:none;"><h1>Vite</h1> <hr> <div data-v-34ea29db><i class="iconfont reco-account" data-v-34ea29db><span data-v-34ea29db>Zeno</span></i> <i class="iconfont reco-date" data-v-34ea29db><span data-v-34ea29db>2023-06-20</span></i> <i class="iconfont reco-eye" data-v-34ea29db><span id="/zeno-blog/views/vite/vite.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-34ea29db><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-34ea29db><span class="tag-item" data-v-34ea29db>Vite</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p><a href="https://vitejs.cn/" target="_blank" rel="noopener noreferrer">Vite官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>推荐课程:<a href="https://www.bilibili.com/video/BV1GN4y1M7P5?p=2&amp;vd_source=e46d9099be60057b5a16a45fac0d5248" target="_blank" rel="noopener noreferrer">b站上的课程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，课程<a href="https://github.com/passerecho/vite-" target="_blank" rel="noopener noreferrer">笔记<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="什么是构建工具"><a href="#什么是构建工具" class="header-anchor">#</a> 什么是构建工具</h2> <blockquote><p>浏览器他只认识html, css, js</p></blockquote> <p><strong>企业级项目里都可能会具备哪些功能</strong></p> <ol><li>typescript: 如果遇到ts文件我们需要使用tsc将typescript代码转换为js代码</li> <li>React/Vue: 安装react-compiler / vue-complier, 将我们写的jsx文件或者.vue文件转换为render函数</li> <li>less/sass/postcss/component-style: 我们又需要安装less-loader, sass-loader等一系列编译工具</li> <li>语法降级: babel ---&gt; 将es的新语法转换旧版浏览器可以接受的语法</li> <li>体积优化: uglifyjs ---&gt; 将我们的代码进行压缩变成体积更小性能更高的文件</li> <li>等等</li></ol> <p>我们需要将这些文件，打包成浏览器认识的<code>JS</code>、<code>CSS</code>、<code>Html</code></p> <p>这些操作异常繁琐，所以就有了<strong>构建工具</strong>，用来自动化处理这些操作。除了自动化集成其他工具外，承担了哪些其他工作？</p> <p><strong>构建工具需要承担了哪些工作</strong></p> <ul><li><p>模块化开发支持</p> <p>例如，<code>Html</code>文件中，使用type指定引入ES Module模块</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> xxx <span class="token keyword">from</span> <span class="token string">'xxx'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>from后只支持指定模块的路径，才能在这个路径下找到</p> <p>如果，直接使用yarn安装模块</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> init -y

<span class="token function">yarn</span> <span class="token function">add</span> xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>浏览器不知道要去node_modules下寻找该模块，而构建工具，可提供模块化支持（想想Vue-cli创建的项目中，依赖都安装在node_modules下，但是依然可以编译后，在浏览器运行，就是这个道理）</p> <p><strong>补充问题</strong>：为什么浏览器中的ESM不能像commonjs（服务端使用）那样，支持自动去node_modules下寻找安装的依赖？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>因为浏览器与服务端不同，html、css、js、安装的依赖+依赖的依赖都会被浏览器通过网络下载
依赖关系往往是十分复杂的，一个依赖包可能依赖了几百个其他的依赖，这会严重降低前端的性能
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>打包工具如何解决?</p> <p>详见[【依赖与构建阶段】]</p></li> <li><p>自动化集成其他工具（不是构建工具做的, 构建工具将这些语法对应的处理工具集成进来自动化处理）</p> <ul><li>处理代码兼容类的工具： 比如babel语法降级，less、sass、ts 语法转换</li> <li>提高项目性能类的工具：压缩文件, <strong>*代码分割</strong>*</li></ul></li> <li><p>优化开发体验</p> <ul><li><p>开发服务器（dev-server）</p> <p>比如，vue-cli 解决跨域的问题。实际上，编写的<code>*.vue</code>、<code>ts</code>、<code>less</code>等文件不能直接运行，构建工具自动化处理这些文件后，启动了一个本地服务器，返回的处理后的内容，就可以成功在浏览器上运行了</p></li> <li><p>构建工具会自动监听文件的变化, 当文件变化以后自动调用对应的集成工具进行重新打包, 然后再浏览器重新运行（热更新）</p></li></ul></li></ul> <p>构建工具让我们不用每次都关心我们的代码在浏览器如何运行，只需要给构建工具提供一个配置文件(没有配置文件，也会有默认的规则)，在启动项目时执行下构建工具，然后就可以专注于开发，而其他工作自动完成</p> <p><strong>主流的构建工具有哪些</strong></p> <ul><li>webpack</li> <li>vite</li> <li>parcel</li> <li>esbuild</li> <li>rollup</li> <li>grunt</li> <li>gulp</li></ul> <h2 id="webpack与vite的区别"><a href="#webpack与vite的区别" class="header-anchor">#</a> Webpack与Vite的区别</h2> <p>webpack需要最依赖分析，将ESM和CommonJS做统一的转换后，在启动服务器，开发者才能看到页面，速度要慢很多</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/Engineering2022092001375420.png" alt="image-20220920013216918"></p> <p>Vite：</p> <ul><li>利用了目前浏览器广泛支持ESM的特点，不再做统一转换，而是直接将ESM模块提供给浏览器处理</li> <li>采用了基于路由拆分的代码模块，不再需要加载模块</li> <li>虽然依赖也通常会存在多种模块化格式（例如 ESM 或者 CommonJS），但是Vite使用更快的esbuild（基于Go多线程开发的打包器，比用JavaScript 编写的打包器 预构建依赖快 10-100 倍。）</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/Engineering2022092001392320.png" alt="image-20220920013237978"></p> <p>侧重点：</p> <ul><li>webpack倾向于关注兼容性</li> <li>vite是基于ESM的，更关注浏览器端的开发</li></ul> <h2 id="vite的简单例子"><a href="#vite的简单例子" class="header-anchor">#</a> vite的简单例子</h2> <p>vite库是一个构建工具库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite -D <span class="token comment"># 开发依赖</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>vite脚手架，用来创建一个完整的项目（其中包含vite依赖库）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> create vite
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>简单的小例子</strong></p> <p>解决前面不使用构建工具，浏览器找不会自动到node_modules下找依赖的问题</p> <ul><li><p>初始化项目</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>安装依赖（以loadsh为例子）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> loadsh -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>示例文件</p> <p>方式一：注意，直接在<code>script</code>标签内使用node_modules中的包不行</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'loadsh'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span>_<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>方式二：使用路径引入的文件中，如果使用了node_modules中的包也不行</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./count.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//count.js</span>

<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'loadsh'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loadsh'</span><span class="token punctuation">,</span>_<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>两种方式都会报错，提示使用路径引入</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/2022092501460522220.png" alt="image-20220925014604987"></p> <p>本例中，使用第二种方式</p> <ul><li><p>安装vite构建工具</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动</p> <p>这里一点知识，使用包管理器安装的依赖，都会在<code>node_modules/.bin</code>创建快捷方式，想调用必须使用下面的方式</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> vite
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一般情况下，会在package.json中加脚本，使用yarn dev即可运行</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>运行后，会运行dev-server。终端出现提示，运行的地址</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20220925015232232420.png" alt="image-20220925015232019"></p> <p>打开就不会有报错了</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/202209250151575864320.png" alt="image-20220925015157680"></p></li></ul> <h2 id="依赖预构建"><a href="#依赖预构建" class="header-anchor">#</a> 依赖预构建</h2> <p>预构建：</p> <ul><li>vite启动时，就会预构建了项目依赖</li> <li>浏览器向devServer请求html页面，浏览器会向import from的路径发起请求（ <code>./count.js</code> 对应的请求地址就是 当其页面地址+ <code>./count.js</code> ），devServer对应的文件</li> <li>如果这个包是不是ESM，则会使用esbuild将该包转化为ESM</li> <li>这个包本身可能依赖很多其他的模块（浏览器下载大量的依赖，会消耗很多时间）。vite将依赖集成为一个js文件</li></ul> <p>接着上一章节的例子讲解。项目成功启动并打印成功，说明vite解决了找不到loadsh包的问题。下面两个图解释了，vite预构建做了啥？</p> <p><strong>浏览器加载的count.js文件</strong></p> <p>会发现引入的loadsh库，实际加载的是<code>/node_modules/.vite/deps/loadsh.js</code>，即依赖预构建缓存的位置</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/202209250239323464320.png" alt="image-20220925023932049"></p> <p><strong>项目下的node_modules目录</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20220925024534asd233320.png" alt="image-20220925024534225"></p> <p><strong>重新预构建的时机</strong></p> <p>Vite 将预构建的依赖项缓存到 <code>node_modules/.vite</code> 中。它会基于以下几个来源来决定是否需要重新运行预构建步骤：</p> <ul><li>包管理器的锁文件内容，例如 <code>package-lock.json</code>，<code>yarn.lock</code>，<code>pnpm-lock.yaml</code>，或者 <code>bun.lockb</code>；</li> <li>补丁文件夹的修改时间；</li> <li><code>vite.config.js</code> 中的相关字段；</li> <li><code>NODE_ENV</code> 的值。</li></ul> <p>上述其中一项发生更改时，就会重新运行预构建</p> <p>如果想要强制 Vite 重新构建依赖项，可以在启动开发服务器时指定 <code>--force</code> 选项，或手动删除 <code>node_modules/.vite</code> 缓存目录</p> <h2 id="vite配置文件格式"><a href="#vite配置文件格式" class="header-anchor">#</a> Vite配置文件格式</h2> <p>注意：修改Vite的配置文件不需要重启，就会生效</p> <h3 id="基础格式"><a href="#基础格式" class="header-anchor">#</a> 基础格式</h3> <p>vite是开箱即用的，即有一套默认的配置规则</p> <p>如果，我们需要自定义配置，需要在项目下使用配置文件<code>vite.config.js</code></p> <p>配置文件内容写成下面的形式，在webstorm中是有配置项提示的，但是在vscode中没有提示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">//vite的配置项</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>需要编译器提示，就要使用下面的写法</p> <ul><li><p>方式一：(<strong>推荐的方式</strong>)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//vite的配置项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>方式二：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**@type import('vite').UserConfig*/</span>
<span class="token keyword">const</span> viteConfig<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token comment">//vite的配置项</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span>  viteConfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h3 id="生产测试环境"><a href="#生产测试环境" class="header-anchor">#</a> 生产测试环境</h3> <p>主配置文件（vite.config.js），在此文件引入不同环境下的配置文件</p> <p>通过启动vite的开发服务器使用不同的启动命令，command参数也会不同</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'defineConfig --&gt; '</span><span class="token punctuation">,</span>command<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p><code>yarn vite dev</code></p> <p>command参数值为serve</p></li> <li><p><code>yarn vite build</code></p> <p>command参数值为build</p></li></ul> <p>添加到package.json中，使用yarn xxx即可运行</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite dev&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>vite.base.config</strong></p> <p>生产、测试共同的vite配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//vite的配置项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>vite.prod.config</strong></p> <p>生产环境的配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//vite的配置项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>vite.dev.config</strong></p> <p>测试环境的配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//vite的配置项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>vite.config.js</strong></p> <p>主配置文件，最终导出vite配置的文件</p> <p>代码运行时会首先执行主配置文件，所有导出的defineConfig函数中的打印会输出到终端后，项目启动</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> viteBaseConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.base.config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteProdConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.prod.config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteDevConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.dev.config&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//策略模式</span>
<span class="token keyword">const</span> envResolver<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'build'</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'生产环境'</span><span class="token punctuation">)</span> 
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>viteBaseConfig<span class="token punctuation">,</span><span class="token operator">...</span>viteProdConfig<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'serve'</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试环境'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>viteBaseConfig<span class="token punctuation">,</span><span class="token operator">...</span>viteDevConfig<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">//最终的vite配置</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'defineConfig --&gt; '</span><span class="token punctuation">,</span>command<span class="token punctuation">)</span> <span class="token comment">//启动vite时，会输出到终端</span>
    <span class="token keyword">return</span> envResolver<span class="token punctuation">[</span>command<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>补充问题</strong></p> <p>启动vite的环境是Node环境，为啥其读取的配置文件<code>vite.config.js</code>中使用的是ESM规范的引入方式？</p> <p>这是因为vite在读取这配置文件时，会先解析文件语法，如果发现ESM规范会直接替换变成Commonjs规范</p> <h2 id="vite环境变量"><a href="#vite环境变量" class="header-anchor">#</a> Vite环境变量</h2> <p>vite启动的环境是Node环境，Node的环境变量是存储在<code>process.env</code>这个对象下</p> <p>vite内置了dotenv这个第三方库</p> <p><strong>默认情况</strong>下，dotenv会自动读取项目下的.env文件, 并解析这个文件中的对应环境变量，并将其注入到process对象中</p> <p><strong>但是</strong>，如果直接注入，会与某些vite配置（例如，envDir用来配置当前环境变量文件的地址）产生冲突问题， 所以，vite需要手动配置读取哪个文件注入到process对象</p> <p>所以，使用loadEnv函数，根据启动Vite的方式加载不同的环境变量文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span> loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> viteBaseConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.base.config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteProdConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.prod.config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteDevConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.dev.config&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//策略模式</span>
<span class="token keyword">const</span> envResolver<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'build'</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'生产环境'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>viteBaseConfig<span class="token punctuation">,</span><span class="token operator">...</span>viteProdConfig<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'serve'</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试环境'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>viteBaseConfig<span class="token punctuation">,</span><span class="token operator">...</span>viteDevConfig<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token comment">//这里的commands（启动的命令）是： build（yarn vite build打包）、serve（yarn vite dev）</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'command --&gt; '</span><span class="token punctuation">,</span>command<span class="token punctuation">)</span>

    <span class="token comment">//这里的mode是：production、development 、mode的参数</span>
    <span class="token comment">//注意：</span>
    <span class="token comment">//  mode 就是vite build --mode xxxx中的xxxx</span>
    <span class="token comment">//  默认 yarn vite build 等价于 yarn vite build --mode=production</span>
    <span class="token comment">//  默认 yarn vite dev 等价于 yarn vite dev --mode=development</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mode --&gt; '</span><span class="token punctuation">,</span>mode<span class="token punctuation">)</span>

    <span class="token comment">//-------加载对应环境的环境变量----------</span>
    <span class="token comment">// 内置函数loadEnv</span>
    <span class="token comment">// 参数1：当前运行的模式。回去查找`.env.[参数1]`文件作为环境变量(即.env.production 、 .env.development)</span>
    <span class="token comment">// 参数2：想要加载的.env文件所在的目录。因为我们的.env文件就在根目录，所以使用process.cwd()函数可以返回运行当前js文件时，所在的目录</span>
    <span class="token comment">// 注意.env文件中的环境变量默认应该为VITE_xxxx格式，xxx将会被作为环境变量。</span>
    <span class="token comment">// 在vite.base.config.js配置了envPrefix:'ENV_'，则环境变量必须是ENV_</span>
    <span class="token comment">// 在项目中，环境变量被放置在import.meta.env中</span>
  	<span class="token comment">// vite.cofing文件中无法通过import.meta.env获取环境变量，但是loadEnv就是全部环境变量</span>
    <span class="token keyword">const</span> env<span class="token operator">=</span><span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 


    <span class="token comment">//-------安装对应环境的返回对应环境的配置文件---------</span>
    <span class="token comment">//这个函数返回的对象，才是最终的vite配置。我们可以将配置写到</span>
    <span class="token comment">//vite.base.config.js（共同的配置） 、vite.dev.config.js（开发的配置） 、vite.base.prod.js（生产的配置）</span>
    <span class="token keyword">return</span> envResolver<span class="token punctuation">[</span>command<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>JS中获取环境变量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 所有的环境变量</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;环境变量&quot;</span><span class="token punctuation">,</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">)</span>


<span class="token comment">// 设置 VITE_BASE_URL=http://127.0.0.1 ，获取该环境变量</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;环境变量&quot;</span><span class="token punctuation">,</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token constant">VITE_BASE_URL</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>HTML中获取环境变量</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Vite is running in %VITE_BASE_URL%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>内置的环境变量</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import.meta.env.MODE: {string} 应用运行的模式。

import.meta.env.BASE_URL: {string} 部署应用时的基本 URL。他由base 配置项决定。

import.meta.env.PROD: {boolean} 应用是否运行在生产环境。

import.meta.env.DEV: {boolean} 应用是否运行在开发环境 (永远与 import.meta.env.PROD相反)。

import.meta.env.SSR: {boolean} 应用是否运行在 server 上
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>为环境变量增加ts类型提示</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">ImportMetaEnv</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> <span class="token constant">VITE_BASE_URL</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="vite的路径别名配置"><a href="#vite的路径别名配置" class="header-anchor">#</a> Vite的路径别名配置</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

<span class="token keyword">const</span> postcssPresetEnv<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span><span class="token punctuation">{</span>
        alias<span class="token operator">:</span><span class="token punctuation">{</span>
          	<span class="token comment">//配置别名</span>
            <span class="token string">&quot;@&quot;</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;@assets&quot;</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./src/assets'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="vite的devserver原理"><a href="#vite的devserver原理" class="header-anchor">#</a> Vite的DevServer原理</h2> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>执行<code>yarn vite dev</code>。Vite会启动一个服务器</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230719145200568320.png" alt="image-20230719145200489"></p> <p>当访问<code>http://localhoost:5137</code>路径时，就会发起一个HTTP请求，路由是<code>/</code>，就返回了<code>index.html</code>文件。所以，<code>index.html</code>是项目的入口</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--html文件是入口，在其中会加载main.js--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>HTML文件中使用module方式加载一个<code>/main.js</code>文件，实际上会发起<code>http://localhoost:5137/main.js</code>的请求（根路径是主机根目录，相对路径是相对于主机目录的）</p> <p>如果线上项目部署在<code>http://www.abc.com:5137/test</code>，这就需要设置vite的配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  base<span class="token operator">:</span><span class="token string">'/test'</span><span class="token punctuation">,</span> <span class="token comment">//再次强调，base选项与其他配置项都不同，base是以部署主机的根目录为相对位置的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样的话打包后的index.html为下面的</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--html文件是入口，在其中会加载/test/main.js--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/test/main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意一点，打包后的文件也要放在test下才能找到的到。我们需要再服务器个目录建一个test目录，再把dist目录下的内容复制过去</p> <p>简单的办法，可以使用outDir配置自动在dist下生成一个test目录。部署时只需要把dist目录下的内容复制直接放到服务器根目录即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  build<span class="token operator">:</span><span class="token punctuation">{</span>
  	outDir<span class="token operator">:</span><span class="token string">'dist/test'</span> <span class="token comment">//默认为dist。这个路径是相对于vite.config.js所在位置的</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>打包后的结果</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230720141636aasad.png" alt="image-20230720141635794"></p> <p>DevServer接到请求<code>/main.js</code>，服务器接到绝对路径请求，会以当前项目根目录为作为根。（注意/main.js并不会以机器的根目录作为根，而是项目根目录）</p> <p>接下来分别讲下<code>main.js</code>不同部分的处理，js文件中的每一个import也都是一个http请求</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js中加载JS。发起/count.js的请求</span>
<span class="token keyword">import</span> count <span class="token keyword">from</span> <span class="token string">'./count'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'countNum --&gt; '</span><span class="token punctuation">,</span>count<span class="token punctuation">.</span>countNum<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//count.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
	countNum<span class="token operator">:</span><span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230619231118aas22220.png" alt="image-20230619231118139"></p> <h3 id="devserver简单实现"><a href="#devserver简单实现" class="header-anchor">#</a> DevServer简单实现</h3> <p>实现了返回index.html、JS文件、支持别名@</p> <p><a href="https://gitee.com/hyj1270433876/example-learn/tree/master/vite-learn/dev-server" target="_blank" rel="noopener noreferrer">https://gitee.com/hyj1270433876/example-learn/tree/master/vite-learn/dev-server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="devserver的配置"><a href="#devserver的配置" class="header-anchor">#</a> DevServer的配置</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    server<span class="token operator">:</span><span class="token punctuation">{</span>
      	<span class="token comment">//当需要在手机浏览器上访问当前项目，需要将host的值设置为true或0.0.0.0。</span>
        host<span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>host设置为true，就多个一个内网地址</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/2023080118562744456777820.png" alt="image-20230801185627427"></p> <h2 id="关于静态资源的引入"><a href="#关于静态资源的引入" class="header-anchor">#</a> 关于静态资源的引入</h2> <h3 id="前提"><a href="#前提" class="header-anchor">#</a> 前提</h3> <p>import仅仅支持引入ES模块，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
	<span class="token function-variable function">xxx</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//xxx</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>require大多用在服务端，可以引入CommonJS模块，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">xxx</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>require还支持引入JSON格式的文件，并自动转换为JS对象</p> <h3 id="后续"><a href="#后续" class="header-anchor">#</a> 后续</h3> <p>所以无论是那种模块化方案，其最重要的是引入JS文件（require可以引入JSON）</p> <p><strong>Vite内置支持处理的静态资源类型</strong></p> <p><a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/constants.ts" target="_blank" rel="noopener noreferrer">内置支持的资源类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>在前端开发中，我们常常再JS中直接引入css、less、sass、图片等等格式的静态文件</p> <p>这其实是DevServer为我们做了资源的处理（使用了loader，加载器），才能在开发环境被加载都项目中</p> <p>打包工具为我们做了资源的处理，才能打包出最后的文件</p> <p><strong>无需处理的静态资源</strong></p> <p>publicDir配置用来指定开放目录（默认值<code>&lt;root&gt;/public</code>，就是根目录下的public目录）</p> <p>假设该目录下有个<code>logo.png</code>，代码中必须用<code>/xxx</code>引用，并不遵守实际路径，记住这个约定</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import '/logo.png'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>打包后，这个目录下的文件不会被命名为<code>[filename]-[hash].ext</code>，直接放置在dist根目录（outDir配置，其默认值为dist）</p> <p>Vite与Webpack</p> <ul><li>在Vite对静态资源的处理是开箱即用的，Vite 会根据文件的类型自动进行处理，使得开发过程中，DevServer能够正确加载和返回资源</li> <li>在webpack中需要使用特定的加载器（loader）来加载静态资源</li></ul> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>后面看到import最直接引入了非JS文件，都是因为vite为我们提供了开箱即用的加载静态资源的能力</p> <p>vue不是vite支持的静态文件，可以安装下面的插件，该插件把<code>.vue</code>文件编译为JS模块，就可以正常加载了</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#为 Vite 构建工具提供对 Vue 单文件组件 (SFC) 的支持</span>
<span class="token function">yarn</span> <span class="token function">add</span> @vitejs/plugin-vue -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在vite中配置插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="静态资源：css"><a href="#静态资源：css" class="header-anchor">#</a> 静态资源：CSS</h2> <p>Vite原生支持CSS，还支持Less、Sass等预处理器</p> <h3 id="引入css的原理"><a href="#引入css的原理" class="header-anchor">#</a> 引入CSS的原理</h3> <p><code>main.js</code>中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./index.css'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在加载CSS时，浏览器会向DevServer发起/index.css的请求</p> <p>DevServer会将CSS处理为JS，并在返回头中设置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Content<span class="token operator">-</span>Type<span class="token operator">=</span>application<span class="token operator">/</span>javascript
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>浏览器会将其作为JS执行，即创建Style标签，将样式复制到其中，接着入到Head标签中</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/**index.css**/</span>
<span class="token selector">body</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>index.css</code>处理后的JS</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/2023061923070033456776520.png" alt="image-20230619230659937"></p> <p>效果：</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230619231839645ff20.png" alt="image-20230619231839568"></p> <h3 id="css-module"><a href="#css-module" class="header-anchor">#</a> CSS Module</h3> <p><strong>造成的问题</strong></p> <p>如果有两个div使用了同名的Class样式。同样插入到Head标签中，靠后的Class会覆盖前面的样式。</p> <p>例如：组件A、组件B</p> <p>componentA/index.css</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.box</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>componentA/index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./index.css'</span>
<span class="token keyword">let</span> div<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
div<span class="token punctuation">.</span>className<span class="token operator">=</span><span class="token string">'box'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>componentB/index.css</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.box</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>componentB/index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./index.css'</span>
<span class="token keyword">let</span> div<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
div<span class="token punctuation">.</span>className<span class="token operator">=</span><span class="token string">'box'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>main.js中加载两个组件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//加载CSS</span>
<span class="token keyword">import</span> <span class="token string">'./components/componentA/index.js'</span>
<span class="token keyword">import</span> <span class="token string">'./components/componentB/index.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>组件B中的box样式覆盖了组件A</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/202306192350227898820.png" alt="image-20230619235022443"></p> <p><strong>改造为CSS Module</strong></p> <p>CSS Module是一种约定，即命名方式为 <code>xxx.module.css</code>的样式文件，就会默认开启</p> <p>过程会自动创建一个映射对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>box<span class="token operator">:</span> <span class="token string">'_box_1pwe8_1'</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Key是原本的类名，Value是新的类名。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>在网页的Head标签之间插入Style标签，样式代码复制到Style之间。样式的类名为Value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>改造：</p> <ul><li><p>两个组件的css文件名，改为 index.module.css</p></li> <li><p>两个组件的JS文件引入CSS，cssModule的box属性，就是新命名的box类名</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> cssModule <span class="token keyword">from</span> <span class="token string">'./index.module.css'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cssModule --&gt; '</span><span class="token punctuation">,</span>cssModule<span class="token punctuation">)</span> <span class="token comment">//{box: '_box_1pwe8_1'}</span>

<span class="token keyword">let</span> div<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
div<span class="token punctuation">.</span>className<span class="token operator">=</span>cssModule<span class="token punctuation">.</span>box <span class="token comment">//使用box类</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>原本的类名box，都被重命名为新的类名，这样就不会重复了</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230619235746vsdg333320.png" alt="image-20230619235745969"></p> <h3 id="预处理器（less、scss）"><a href="#预处理器（less、scss）" class="header-anchor">#</a> 预处理器（less、scss）</h3> <p><strong>less</strong></p> <p>Vite支持自动调用预处理器，由于其并没有内置预处理器，所以需要用户手动安装所需的预处理器。下面以less为例子：</p> <p>安less依赖，用来编译Less文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add <span class="token operator">-</span><span class="token constant">D</span> less
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建less文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>index<span class="token punctuation">.</span>module<span class="token punctuation">.</span>less   <span class="token comment">//开启CSS Module</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>组件A，仅仅是引入名字改为<code>index.module.less</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> cssModule <span class="token keyword">from</span> <span class="token string">'./index.module.less'</span>

<span class="token keyword">let</span> div<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
div<span class="token punctuation">.</span>className<span class="token operator">=</span>cssModule<span class="token punctuation">.</span>box
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Vite会自动将其插入网页</p> <p><strong>scss</strong></p> <p>注意还需要按照一个sass-loader</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> sass sass-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="postcss"><a href="#postcss" class="header-anchor">#</a> postcss</h3> <p>对CSS进行后处理，例如：</p> <ul><li>为有兼容性问题的CSS属性，增加前缀(--webkit)或者替换为低级语法</li> <li>把px单位转换为vw单位</li></ul> <p>postcss插件列表：</p> <ul><li>官方：<a href="https://github.com/postcss/postcss#plugins" target="_blank" rel="noopener noreferrer">https://github.com/postcss/postcss#plugins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>社区：<a href="https://www.postcss.parts/" target="_blank" rel="noopener noreferrer">https://www.postcss.parts/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><strong>新建一个项目</strong></p> <p>初始化：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> postcss-cli postcss -D

<span class="token comment"># postcss-cli 脚手架，提供一些命令。参考：https://www.npmjs.com/package/postcss-cli</span>
<span class="token comment"># postcss 处理器，用来实际去执行命令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>安装一个插件：</p> <ul><li><p>安装<a href="https://github.com/csstools/postcss-preset-env" target="_blank" rel="noopener noreferrer">postcss-preset-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>插件作用：语法降级（比如支持css变量）、自动补全（autoprefixer插件的功能，注意postcss-preset-env包含了该插件）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D postcss-preset-env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用配置文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//postcss.config.js</span>
<span class="token keyword">const</span> postcssPresetEnv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token function">postcssPresetEnv</span><span class="token punctuation">(</span><span class="token comment">/* pluginOptions */</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>准备index.css</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:root</span><span class="token punctuation">{</span>
    <span class="token property">--globalColor</span><span class="token punctuation">:</span>red
<span class="token punctuation">}</span>

<span class="token selector">div</span><span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--globalColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>处理</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>npx postcss index.css  --output result.css 
<span class="token comment">#将index.css 转换为 result.css</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>转换后的result.css文件</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:root</span><span class="token punctuation">{</span>
    <span class="token property">--globalColor</span><span class="token punctuation">:</span>red
<span class="token punctuation">}</span>

<span class="token selector">div</span><span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> red <span class="token comment">/*低级语法写前面，这样能保证高级语法失效时，低级语法能生效*/</span>
<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--globalColor<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <p><strong>注意:</strong></p> <p>原本postcss是有less、sass相关的预设插件的，只要安装这些插件就可以自动完成less、sass编译后，执行后学的插件功能。但是由于less、sass官方每次发布新特性，postcss插件都需要跟随发布新的版本，这导致了这些插件后续逐渐不再被维护</p> <p>目前，如果想要处理less、sass都必须手动安装编译，postcss的目标仅仅是对编译后的css文件进行处理</p> <p>所以，后来业界也称postcss为<strong>后处理器</strong>。（注意postcss其实是有能力替代less、sass作为处理样式文件唯一的工具的，只是目前的趋势是仅仅将其作为后处理器）</p> <p><strong>vite配置</strong></p> <p>vite中直接支持了postcss，不像less、sass需要手动安装编译器</p> <p>postcss直接配置即可生效，如果配置postcss插件是需要下载插件的</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D postcss-preset-env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//注意这里，vite.config.js实际读取的环境是commonJS，vite会自动将ESM转换为commonJS</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

<span class="token keyword">const</span> postcssPresetEnv<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    css<span class="token operator">:</span><span class="token punctuation">{</span>
			postcss<span class="token operator">:</span><span class="token punctuation">{</span>
            plugins<span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token function">postcssPresetEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
       <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>vite也支持自动读取<code>postcss.config.js</code>中的postcss配置，但是，<code>vite.config.js</code>的postcss字段的优先级最高</p> <p><strong>postcss-px-to-viewport 插件</strong></p> <p>将px转换为vw，可以对不同设备进行布局适配</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> postcssPxToViewport <span class="token keyword">from</span> <span class="token string">'postcss-px-to-viewport'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    css<span class="token operator">:</span> <span class="token punctuation">{</span>
        postcss<span class="token operator">:</span> <span class="token punctuation">{</span>
            plugins<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// viewport 布局适配</span>
                <span class="token function">postcssPxToViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    viewportWidth<span class="token operator">:</span> <span class="token number">375</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="css-in-js"><a href="#css-in-js" class="header-anchor">#</a> CSS In JS</h3> <p>CSS In JS方案: <code>styled-components</code>和<code>emotion</code></p> <p>对于 CSS In JS 方案，在构建侧我们需要考虑<code>选择器命名问题</code>、<code>DCE</code>(Dead Code Elimination 即无用代码删除)、<code>代码压缩</code>、<code>生成 SourceMap</code>、<code>服务端渲染(SSR)</code>等问题，而<code>styled-components</code>和<code>emotion</code>已经提供了对应的 babel 插件来解决这些问题，我们在 Vite 中要做的就是集成这些 babel 插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      babel<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 加入 babel 插件</span>
        <span class="token comment">// 以下插件包都需要提前安装</span>
        <span class="token comment">// 当然，通过这个配置你也可以添加其它的 Babel 插件</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// 适配 styled-component</span>
          <span class="token string">&quot;babel-plugin-styled-components&quot;</span>
          <span class="token comment">// 适配 emotion</span>
          <span class="token string">&quot;@emotion/babel-plugin&quot;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 注意: 对于 emotion，需要单独加上这个配置</span>
      <span class="token comment">// 通过 `@emotion/react` 包编译 emotion 中的特殊 jsx 语法</span>
      jsxImportSource<span class="token operator">:</span> <span class="token string">&quot;@emotion/react&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="css原子化框架"><a href="#css原子化框架" class="header-anchor">#</a> CSS原子化框架</h3> <p>例如：Tailwind CSS、Windi CSS</p> <p>下面以Windi CSS为例子，集成到Vite中</p> <p><strong>安装</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">pnpm</span> i windicss vite-plugin-windicss -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>配置</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">windi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>引入</strong></p> <p>main.js中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 用来注入 Windi CSS 所需的样式</span>
<span class="token keyword">import</span> <span class="token string">&quot;virtual:windi.css&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="css相关配置"><a href="#css相关配置" class="header-anchor">#</a> CSS相关配置</h3> <p>vue.base.config.js配置文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    css<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//css相关配置</span>

        <span class="token comment">//modules字段会传给postcss</span>
        modules<span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token comment">//假设css文件类名为footer-content，</span>
            <span class="token comment">//在js中引入css文件后 `import componentACss from xxx`</span>
            <span class="token comment">//设置camelCaseOnly，在js中使用 componentACss.footerContent 访问到该样式</span>
            localsConvention<span class="token operator">:</span><span class="token string">&quot;camelCaseOnly&quot;</span><span class="token punctuation">,</span>

            <span class="token comment">//全局样式global（css会以原本的类名插入页面style标签）、局部样式local（默认值。即开启css module）</span>
            scopeBehaviour<span class="token operator">:</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">,</span>

            <span class="token comment">//scopeBehaviour是local,这个配置css module的每个样式名</span>
            <span class="token comment">//name文件名，local原本的css类名，hash:5前五位哈希值 (参考：https://github.com/webpack/loader-utils#interpolatename)</span>
            <span class="token comment">// generateScopedName:&quot;[name]_[local]_[hash:5]&quot;</span>
            <span class="token comment">// generateScopedName:(name,fileName,css)=&gt;{</span>
            <span class="token comment">//     //name 原本的css类名,fileName 样式文件绝对路径, css 当前那个样式</span>
            <span class="token comment">//     return `${name}_111`</span>
            <span class="token comment">// }</span>

            <span class="token comment">//相当于给hash加盐</span>
            hashPrefix<span class="token operator">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>

            <span class="token comment">//指定哪些样式文件不使用css module</span>
            globalModulePaths<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'./components/componentA/index.module.less'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">//key是预处理器名 ，value是该预处理器配置</span>
        preprocessorOptions<span class="token operator">:</span><span class="token punctuation">{</span>  
          	scss<span class="token operator">:</span><span class="token punctuation">{</span>
              <span class="token comment">//指定全局变量所在的文件</span>
              additionalData<span class="token operator">:</span><span class="token string">'@import &quot;./src/styles/variable.scss&quot;;'</span> <span class="token comment">//注意:';'一定要写，否则报错</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            less<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//这里的配置项其实就是less的命令行参数。参考：https://lesscss.org/usage/#less-options</span>

                <span class="token comment">//等价于 lessc --math='always' xxx.less 。</span>
                <span class="token comment">//less默认会括号中的进行数学运算 width:(100px/2) </span>
                <span class="token comment">//配置为always。就会将 width:100px/2 编译成 width:50px</span>
                math<span class="token operator">:</span><span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span>

                <span class="token comment">//在global.less定义变量 @mainColor:'red' ，在index.less中想要使用需要@import url('./global.less)引入后才能使用</span>
                <span class="token comment">//我们可以定义全局的变量，直接使用，不必再引入</span>
                globalVars<span class="token operator">:</span><span class="token punctuation">{</span>
                    mainColor<span class="token operator">:</span><span class="token string">&quot;red&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">//开启css的sourcemap功能</span>
        devSourcemap<span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>devSourcemap选项</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230623114057aassfff20.png" alt="image-20230623114056566"></p> <h2 id="静态资源：svg"><a href="#静态资源：svg" class="header-anchor">#</a> 静态资源：SVG</h2> <p>img的src可以直接使用SVG</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@/assets/images/loading.svg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可以，使用插件<code>vite-plugin-svg-icons</code>来进行加载SVG（特点：<strong>预加载</strong>、<strong>高性能</strong> ）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># https://github.com/vbenjs/vite-plugin-svg-icons/blob/main/README.zh_CN.md</span>
<span class="token function">pnpm</span> <span class="token function">install</span> vite-plugin-svg-icons -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置插件</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>createSvgIconsPlugin<span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'vite-plugin-svg-icons'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">createSvgIconsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 指定svg图标放置的目录</span>
      iconDirs<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/assets/icons'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 加载的格式</span>
      symbolId<span class="token operator">:</span> <span class="token string">'icon-[dir]-[name]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>main.ts引入虚拟模块</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">'virtual:svg-icons-register'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用SVG</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--   可以使用css定义宽高   --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>30px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token comment">&lt;!--   #icon-xxx加载xxx.svg   --&gt;</span>
 		<span class="token comment">&lt;!--   fill填充svg图标颜色   --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#icon-guard<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yellow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>use</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="打包配置"><a href="#打包配置" class="header-anchor">#</a> 打包配置</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> build <span class="token comment">#yarn vite build</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>生成一个dist目录</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230709174436f3233320.png" alt="image-20230709174436486"></p> <p>几个问题：</p> <ul><li><p>为什么assets下的静态资源会带hash值</p> <p>浏览器有缓存机制，如果同一个文件名，浏览器第二次请求，会直接使用缓存。为了保证修改后重新打包，使用浏览器访问能立即生效，所以，每次文件有变动，打包后都会生成新的名字（hash值部分变化）</p></li> <li><p><code>baseUrl:'/'</code></p> <p>默认vite配置为<code>/baseUrl:'/'</code>，可以看到打包后的index.html中所有的路径都是<code>/</code>开头的</p> <p>dist目录下的所有文件，放在主机路径下这里就能正常访问了</p> <p>如果放在了下面的路径</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http:/xxx.xxx.com/yyy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>baseUrl:'/yyy'</code></p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230709192258vvv20.png" alt="image-20230709192257826"></p></li></ul> <p>常用配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

<span class="token keyword">const</span> postcssPresetEnv<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">//打包构建相关配置(即，vite build执行打包时的配置)</span>
      build<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//打包构建相关配置(vite build)</span>
        
        minify<span class="token operator">:</span><span class="token string">&quot;false&quot;</span> <span class="token comment">//默认true，即将打包后的js压缩</span>
        
        rollupOptions<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//配置rollup的构建策略。rollup文档：https://www.rollupjs.com/guide/big-list-of-options#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD-core-functionality</span>
            output<span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token comment">//rollup的assetFileNames配置。该选项用于自定义构建结果中的“静态文件”名称</span>
                <span class="token comment">//配置文档：https://www.rollupjs.com/guide/big-list-of-options#outputassetfilenames</span>
                <span class="token comment">//经过实际测试，[assetFileNames]仅仅能指定非js的静态资源的输出路径及命名方式</span>
                assetFileNames<span class="token operator">:</span><span class="token string">&quot;[hash].[name].[ext]&quot;</span> <span class="token comment">//默认值: assets/[name]-[hash][extname]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            
        assetsInlineLimit<span class="token operator">:</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token comment">//单位B，默认值4096B。小于这个限制的静态资源会被转化为base64格式，代码中引入base64。超过这个限制就直接使用静态资源，代码中引入静态资源的路径</span>
        
        outDir<span class="token operator">:</span><span class="token string">'dist'</span><span class="token punctuation">,</span> <span class="token comment">// 默认在根目录下生成dist目录，将打包后的内容输出到dist下。这里可以设置打包生成的目录,</span>
        
        assetsDir<span class="token operator">:</span><span class="token string">'statics11'</span><span class="token punctuation">,</span> <span class="token comment">//默认是 [outDir配置]/assets 。经过实际测试，这里个仅仅会将打包的js文件放置在[assetsDir]目录下。如需设置其他静态资源，请示运功</span>
        
        <span class="token comment">// emptyOutDir:'' //默认为true，构建之前自动清空[outDir配置]的目录</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>注意：</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230709193704vdfgn20.png" alt="image-20230709193703592"></p> <h2 id="vite库配置"><a href="#vite库配置" class="header-anchor">#</a> Vite库配置</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>

  <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  

  <span class="token comment">// 添加库模式配置</span>

  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    rollupOptions<span class="token operator">:</span><span class="token punctuation">{</span>
  		external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//配置的库 ，不会被打包到最终产物中</span>
  		output<span class="token operator">:</span> <span class="token punctuation">{</span>
    		globals<span class="token operator">:</span> <span class="token punctuation">{</span>
      		vue<span class="token operator">:</span> <span class="token string">&quot;Vue&quot;</span><span class="token punctuation">,</span> <span class="token comment">//这里配置 库名到全局变量的映射。代码中使用了全局变量Vue，就会被替换为使用vue包（需保证项目安装了vue包）</span>
          lodash<span class="token operator">:</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">,</span>
    		<span class="token punctuation">}</span><span class="token punctuation">,</span>
  		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
    minify<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//boolean | 'terser' | 'esbuild'；默认使用esbuild混淆压缩，也可以安装terser</span>
    
  	lib<span class="token operator">:</span> <span class="token punctuation">{</span>
      entry<span class="token operator">:</span> <span class="token string">&quot;./src/entry.ts&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件。因为库不能使用 HTML 作为入口</span>
      name<span class="token operator">:</span> <span class="token string">&quot;SmartyUI&quot;</span><span class="token punctuation">,</span> <span class="token comment">//暴露的全局变量</span>
      fileName<span class="token operator">:</span> <span class="token string">&quot;smarty-ui&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输出的包名。（默认是 package.json 的 name 选项）</span>
      formats<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;es&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;iife&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 导出模块格式（iife是立即执行函数的意思）</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="vite处理跨域问题"><a href="#vite处理跨域问题" class="header-anchor">#</a> Vite处理跨域问题</h2> <p><a href="https://cn.vitejs.dev/config/server-options.html#server-proxy" target="_blank" rel="noopener noreferrer">Vite文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>原理：</p> <p>项目中请求 <code>http://www.abc.com/api/123</code>接口出现跨域</p> <p>但是配置代理，向<code>http://www.abc.com/api</code>发起请求的接口会被devServer拦截到</p> <p>devServer会再转发到${target}/api/123</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig<span class="token punctuation">,</span> loadEnv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> command<span class="token punctuation">,</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        server<span class="token operator">:</span><span class="token punctuation">{</span>
            proxy<span class="token operator">:</span><span class="token punctuation">{</span>
              	<span class="token comment">// 项目实际请求地址 http://www.cde.com/xxx</span>
              
              	<span class="token comment">// 如果使用代理，必须让请求被devServe拦截到，有devServe向实际的地址请求</span>
              	<span class="token comment">// 项目需设置请求的BaseUrl为/api （请求地址就成了 '网址地址/api/xxx'）</span>
              	
                <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 所有请求中的前缀能匹配到 '网址地址/api/xxx' 的请求被devServe拦截</span>
                  	
                    target<span class="token operator">:</span> <span class="token string">'http://www.cde.com'</span><span class="token punctuation">,</span> <span class="token comment">// devServer将这个请求的前缀替换为${target}/api/xxx。这与实际接口地址不符，需要使用rewrite字段重写请求</span>
                  
                    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//开启跨域</span>
                  
                    <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                  	<span class="token comment">//是否重写devServe实际请求地址，这个取决于接口的地址</span>
                  	<span class="token comment">//例如：这里接口地址为http://www.cde.com/xxx，则需将/api替换为空格</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>当请求<code>${target}/api</code>时，就不会出现跨域问题</p> <h2 id="vite插件（待补充）"><a href="#vite插件（待补充）" class="header-anchor">#</a> Vite插件（待补充）</h2> <p><a href="https://cn.vitejs.dev/plugins/" target="_blank" rel="noopener noreferrer">插件官方页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="插件设计"><a href="#插件设计" class="header-anchor">#</a> 插件设计</h3> <p>Vite存在生命周期，我们可以指定在Vite的不同生命周期，使用不同的插件来达成我们的目标</p> <p><a href="https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks" target="_blank" rel="noopener noreferrer">Vite特有的钩子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <ul><li><p>config</p> <p>在解析 Vite 配置前调用</p></li> <li><p>configResolved</p> <p>在解析 Vite 配置后调用</p></li> <li><p>configureServer</p> <p>是用于配置开发服务器的钩子（ <a href="https://cn.vitejs.dev/guide/api-javascript.html#vitedevserver" target="_blank" rel="noopener noreferrer">ViteDevServer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p></li> <li><p>configurePreviewServer</p> <p>用于预览服务器</p></li> <li><p>transformIndexHtml</p> <p>转换 <code>index.html</code> 的专用钩子</p></li> <li><p>handleHotUpdate</p> <p>执行自定义 HMR 更新处理</p></li></ul> <p>一般情况下，插件导出的都是函数，函数的入参就是插件的配置，函数的返回值是一个vite的配置对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">customConfig</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// customConfig 接收插件的配置。进行内部处理</span>
  
  <span class="token comment">// 最终需要返回一个对象。里面是vite的配置，该配置会在特点的生命周期与Vite的配置合并</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'插件名字'</span>
    <span class="token comment">//yyy、xxx是生命周期钩子</span>
    <span class="token function-variable function">yyy</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">xxx</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> 
      	<span class="token comment">//xxx钩子返回的vite的配置</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="vite-plugin-html插件"><a href="#vite-plugin-html插件" class="header-anchor">#</a> vite-plugin-html插件</h3> <p><a href="https://www.npmjs.com/package/vite-plugin-html" target="_blank" rel="noopener noreferrer">npm地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>vite.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createHtmlPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> 'vite<span class="token operator">-</span>plugin<span class="token operator">-</span>html

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//---------处理index.html----------</span>
        <span class="token function">createHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
             inject<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//注入数据。HTML中的&lt;%-xxxx %&gt;显示数据</span>
                 data<span class="token operator">:</span> <span class="token punctuation">{</span>
                 	title<span class="token operator">:</span> <span class="token string">'首页'</span><span class="token punctuation">,</span>
                 	injectScript<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script src=&quot;./inject.js&quot;&gt;&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>  
         <span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">//第三方插件</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>index.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%-title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    &lt;%- injectScript %&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    测试
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>实现vite-plugin-html</strong></p> <p>插件代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">userOption<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> injectData<span class="token operator">=</span>userOption<span class="token operator">?.</span>inject<span class="token operator">?.</span>data<span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'create-html-plugin'</span><span class="token punctuation">,</span>
      enforce<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
      <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> injectData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// console.log(`&lt;%-${key}%&gt;`,injectData[key])</span>
        html<span class="token operator">=</span>html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;%-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>injectData<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>

        <span class="token comment">// 在这里可以修改HTML的内容</span>
        <span class="token keyword">return</span> html
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>配置vite.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> CreateHtmlPlugin  <span class="token keyword">from</span> <span class="token string">'./plugins/CreateHtmlPlugin'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token function">CreateHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            inject<span class="token operator">:</span> <span class="token punctuation">{</span>
                data<span class="token operator">:</span> <span class="token punctuation">{</span>
                    title<span class="token operator">:</span> <span class="token string">'首页'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="vite-aliases插件"><a href="#vite-aliases插件" class="header-anchor">#</a> vite-aliases插件</h3> <p>使用这个插件，就不必在项目中使用别名配置了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>resolve<span class="token operator">:</span><span class="token punctuation">{</span>
        alias<span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token string">&quot;@&quot;</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./src'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>默认，插件会生成别名 ，详情参考：<a href="https://github.com/subwaytime/vite-aliases" target="_blank" rel="noopener noreferrer">仓库地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite-aliases -D <span class="token comment"># 使用node16以上版本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ViteAliases <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite-aliases'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ViteAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>实现vite-plugin-aliases插件</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getTotalFolder</span><span class="token punctuation">(</span><span class="token parameter">basePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> resAliasObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    resAliasObj<span class="token punctuation">[</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> basePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> dirArr <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> basePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dirArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileOrDirName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> statInfo <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>
            path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> basePath<span class="token punctuation">,</span> fileOrDirName<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>statInfo<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            resAliasObj<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileOrDirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
                __dirname<span class="token punctuation">,</span>
                basePath<span class="token punctuation">,</span>
                fileOrDirName
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resAliasObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">//config钩子，在解析 Vite 配置前调用。将最终返回的对象与vite.config.js合并，作为最终的vite配置</span>
        <span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//注意，插件是在Vite中处理（Node环境），所以这里的输出在Node的控制台</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;config--&gt;&quot;</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//vite.config.js中的配置对象</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;env--&gt;&quot;</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { mode: 'development', command: 'serve', ssrBuild: false }</span>

            <span class="token keyword">let</span> aliasObj <span class="token operator">=</span> <span class="token function">getTotalFolder</span><span class="token punctuation">(</span><span class="token string">&quot;../src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aliasObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
                    alias<span class="token operator">:</span> aliasObj<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="vite-plugin-mock插件"><a href="#vite-plugin-mock插件" class="header-anchor">#</a> vite-plugin-mock插件</h3> <p><a href="https://github.com/vbenjs/vite-plugin-mock/blob/main/README.zh_CN.md" target="_blank" rel="noopener noreferrer">插件GitHub文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite-plugin-mock mockjs -D

<span class="token comment"># vite-plugin-mock的mock功能依赖于mockjs，所以这里还需要安装mockjs</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> viteMockServe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite-plugin-mock'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token function">viteMockServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            mockPath<span class="token operator">:</span> <span class="token string">'mock'</span><span class="token punctuation">,</span><span class="token comment">//放置mock文件的目录</span>
        		enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//启用mock</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>配置接口mock数据（mock文件，必须要放在根目录/mock下）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//index.js</span>
<span class="token keyword">import</span> mockJS <span class="token keyword">from</span> <span class="token string">'mockjs'</span>


<span class="token comment">//使用mockJS生成的100条数据</span>
<span class="token keyword">const</span> userList<span class="token operator">=</span>mockJS<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//mockjs文档地址：http://mockjs.com/examples.html#Name</span>
    <span class="token string">&quot;data|100&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span> <span class="token comment">//100条数据</span>
        <span class="token punctuation">{</span>
            cname<span class="token operator">:</span><span class="token string">'@cname'</span><span class="token punctuation">,</span><span class="token comment">//中文名</span>
            <span class="token string">&quot;id|+1&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//递增的id</span>
            time<span class="token operator">:</span><span class="token string">&quot;@time&quot;</span><span class="token punctuation">,</span> <span class="token comment">//'00:14:47'</span>
            data<span class="token operator">:</span><span class="token string">'@date'</span> <span class="token comment">//'1980-09-20'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      	<span class="token comment">//定义一个接口</span>
        url<span class="token operator">:</span><span class="token string">'/api/users'</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">response</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>body<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
            <span class="token comment">//body 请求体</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                code<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span>userList<span class="token punctuation">,</span>
                msg<span class="token operator">:</span><span class="token string">'ok'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>测试插件功能</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/users'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span><span class="token string">'post'</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/202307311824203522221120.png" alt="image-20230731182419704"></p> <h3 id="console消除插件（待补充）"><a href="#console消除插件（待补充）" class="header-anchor">#</a> console消除插件（待补充）</h3> <h3 id="打包后静态资源自动上传cdn插件（待补充）"><a href="#打包后静态资源自动上传cdn插件（待补充）" class="header-anchor">#</a> 打包后静态资源自动上传cdn插件（待补充）</h3> <h3 id="console徽章"><a href="#console徽章" class="header-anchor">#</a> console徽章</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">JSDOM</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;jsdom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> execSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;child_process&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">outputConsoleStr</span><span class="token punctuation">(</span><span class="token parameter">output</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> styleArr<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">'background:green'</span><span class="token punctuation">,</span>
        <span class="token string">'color:#FFFFFF'</span><span class="token punctuation">,</span>
        <span class="token string">'font-weight: bold'</span><span class="token punctuation">,</span>
        <span class="token string">'padding:5px'</span><span class="token punctuation">,</span>
        <span class="token string">'border:1px solid #fff'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">console.log('%c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>output<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">','</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styleArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">');</span><span class="token template-punctuation string">`</span></span>
   
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">userOption<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
        customExtendInfo<span class="token operator">=</span><span class="token keyword">null</span> <span class="token comment">//自定义字段</span>
    <span class="token punctuation">}</span><span class="token operator">=</span>userOption

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;vite-plugin-mark-version&quot;</span><span class="token punctuation">,</span>
        <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> commitInfo <span class="token operator">=</span> <span class="token function">execSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git log -1 HEAD --pretty='%cd,%an,%s,%h'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                encoding<span class="token operator">:</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           
            <span class="token comment">//将html字符串转化为Dom</span>
            <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSDOM</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> document <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">;</span>

            <span class="token comment">//获取Git信息</span>
            <span class="token keyword">const</span> commitInfoList <span class="token operator">=</span> commitInfo<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> infoMeta <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            infoMeta<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            infoMeta<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;auth&quot;</span><span class="token punctuation">,</span> commitInfoList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            infoMeta<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> commitInfoList<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            infoMeta<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> commitInfoList<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>customExtendInfo<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> customExtendInfo<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    infoMeta<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> customExtendInfo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//向HTML中插入信息</span>
            document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>infoMeta<span class="token punctuation">)</span>


            <span class="token comment">//向浏览器控制台输出信息</span>
            <span class="token keyword">let</span> resOutput<span class="token operator">=</span><span class="token string">''</span>
            <span class="token keyword">const</span> script<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
            resOutput<span class="token operator">+=</span><span class="token function">outputConsoleStr</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">作者: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitInfoList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            resOutput<span class="token operator">+=</span><span class="token function">outputConsoleStr</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">提交msg: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitInfoList<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            resOutput<span class="token operator">+=</span><span class="token function">outputConsoleStr</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">环境: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            script<span class="token punctuation">.</span>textContent<span class="token operator">=</span>resOutput
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>

            <span class="token keyword">return</span> dom<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>这是简书的console种显示的徽章</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230823181316asssssss20.png" alt="image-20230823181316269"></p> <h2 id="vite集成ts"><a href="#vite集成ts" class="header-anchor">#</a> Vite集成TS</h2> <p>Vite天生支持TS，但是其仅仅执行 <code>.ts</code> 文件的转译工作（TS类型检查不通过也能正常执行），<strong>并不执行</strong> 任何类型检查，并假定TS的类型错误已经被 IDE 显示出来，并被开发者处理了</p> <p>如下运行一个项目，会发现main.ts文件内的代码正常执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 初始化项目</span>
<span class="token function">yarn</span> init -y

<span class="token comment"># 装vite</span>
<span class="token function">yarn</span> <span class="token function">add</span> vite -D


<span class="token comment"># 新建main.ts </span>

<span class="token comment"># 新建index.html, 引入ts文件 &lt;script src=&quot;./main.ts&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span>


<span class="token comment"># 在package.json中增加了脚本&quot;scripts&quot;: {&quot;dev&quot;:&quot;vite dev&quot;}，启动vite</span>
<span class="token function">yarn</span> dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>但是</strong></p> <p>ts代码如果发生类型错误（这里的报错是编辑器提示的错误，getStuName的入参应该是string类型，但是传入的是number类型），终端与浏览器仍然会正常执行，无任何报错</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230711233924v20.png" alt="image-20230711233923555"></p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230712000244b20.png" alt="image-20230712000244719"></p> <p><strong>解决</strong></p> <p>使用插件：<a href="https://vite-plugin-checker.netlify.app/introduction/introduction.html" target="_blank" rel="noopener noreferrer">vite-plugin-checker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>前提：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> typescript -D  <span class="token comment">#该插件依赖typescript</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>根目录下增加 tsconfig.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//跳过对库的ts检查（不加这句，就会输出node_modules下的一些检查信息）</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span> <span class="token comment">//TS编译后产物的JS版本</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/**/*.ts&quot;</span><span class="token punctuation">]</span> <span class="token comment">//设置ts检查的目录</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span>  vite-plugin-checker -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// e.g. use TypeScript check</span>
      typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>结果：</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230712000138e20.png" alt="image-20230712000138259"></p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230712000154r20.png" alt="image-20230712000154378"></p> <p>补充一点：build脚本需要改成下面的，可以让TS类型检查出现错误后，阻止Vite继续构建</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite dev&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span><span class="token string">&quot;tsc --noEmit &amp;&amp; vite build&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr> <p>在代码中使用环境变量时，报TS错误。解决方案参考<a href="https://cn.vitejs.dev/guide/env-and-mode.html#intellisense" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230712002635y20.png" alt="image-20230712002635718"></p> <p>安装node相关的类型</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> @types/node -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>vite.config.ts</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span>loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//加载.env.*文件</span>
    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//不安装@types/node,这里就会提示没有process</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
          	<span class="token comment">//启动ts检查插件</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>在src下，新建<code>env.d.ts</code>（注意，一定是放在src下，否则不生效）</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span>

<span class="token keyword">interface</span> <span class="token class-name">ImportMetaEnv</span> <span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token constant">VITE_BASE_URL</span><span class="token operator">:</span> <span class="token builtin">string</span>  <span class="token comment">//需要的环境变量定义在这里</span>
    <span class="token comment">// 更多环境变量...</span>
  <span class="token punctuation">}</span>
  
<span class="token keyword">interface</span> <span class="token class-name">ImportMeta</span> <span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> env<span class="token operator">:</span> ImportMetaEnv
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="vite性能优化"><a href="#vite性能优化" class="header-anchor">#</a> Vite性能优化</h2> <p>性能优化包括哪些？</p> <ul><li><p>开发时构建优化</p> <p>使用<code>yarn dev</code>、<code>yarn serve</code>启动项目的时长。vite是利用浏览器对ESM的支持，按需加载的，速度很快</p></li> <li><p>页面性能指标：首屏渲染（FP，First Paint）、首屏渲染（FCP，Frist Content Paint）</p> <ul><li>页面懒加载</li> <li>http优化：强缓存、协商缓存</li></ul></li> <li><p>生产的构建优化</p> <ul><li>优化体积：分包、构建产物压缩、treeshaking、图片资源的压缩、cdn加载静态资源</li></ul></li></ul> <h3 id="分包策略"><a href="#分包策略" class="header-anchor">#</a> 分包策略</h3> <p>在上面使用TS的项目的架子</p> <p>安装lodash</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> lodash <span class="token comment"># 安装lodash</span>
 
<span class="token function">yarn</span> <span class="token function">add</span> @types/lodash -D <span class="token comment"># 安装lodash的类型声明</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>main.ts中</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> forEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>修改tsconfig.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>
      	<span class="token comment">// 文档：https://typescript.bootcss.com/module-resolution.html</span>
      	<span class="token comment">//值：Classic（默认值）| Node 。例如ts中使用import {a} from 'xxx' ,</span>
      	<span class="token comment">//    Classic会在当前目录下查找xxx.ts、xxx.d.ts，找不到就到上级查找这两个文件</span>
      	<span class="token comment">//    Node，是按照Node的方式查找依赖。xxx是路径就去该路径下找，如果是包名，就去node_modules下查找</span>
        <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span><span class="token string">&quot;Node&quot;</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/**/*.ts&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>修改vite.config.ts</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span>loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        build<span class="token operator">:</span><span class="token punctuation">{</span>
          	<span class="token comment">//这里增加配置，打包后js不压缩</span>
            minify<span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>执行打包(yarn build)，打包的js文件中完整的写入了lodash文件</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230715182318gh20.png" alt="image-20230715182317769"></p> <p>前面学过，只要代码发生变化，打包后的js文件名中的hash部分就会变化。这是因为浏览器如果发现曾经请求同名文件，就会直接使用缓存。只要保证打包后部署后的文件名变换了，用户访问网站时就一定会请求新的js文件</p> <p><strong>提出问题</strong></p> <p>像loadsh这种，在开发中引入的第三方，只要不改变版本是不会变化的</p> <p>业务代码变化会导致文件名变化，每次用户重新请求时，整个文件也会重新返回给用户，但是其中的loash等第三方库是不会变化的</p> <p><strong>解决问题</strong></p> <p>修改vite.config.ts配置</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span>loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        build<span class="token operator">:</span><span class="token punctuation">{</span>
            minify<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
            rollupOptions<span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token string">&quot;output&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  	<span class="token comment">//新增配置</span>
                    <span class="token string">&quot;manualChunks&quot;</span><span class="token operator">:</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'build输出：'</span><span class="token punctuation">,</span>sourcePath<span class="token punctuation">)</span>
                        
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>yarn build后，控制台输出。可以看出来配置manualChunks的参数是打包的源文件</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230715190932hj0.png" alt="image-20230715190932113"></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span>loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        build<span class="token operator">:</span><span class="token punctuation">{</span>
            minify<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
            rollupOptions<span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token string">&quot;output&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token string">&quot;manualChunks&quot;</span><span class="token operator">:</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'build输出：'</span><span class="token punctuation">,</span>sourcePath<span class="token punctuation">)</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">return</span> <span class="token string">'vendor'</span> <span class="token comment">//文件名。默认打包后的命名规则一般是[fileName]-[hash].js</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230715191351jk20.png" alt="image-20230715191351536"></p> <p>可以看到lodash文件被单独打包到一个单独文件中。且业务代码变化后，再次打包这个文件名不会变化</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230715191508loi20.png" alt="image-20230715191508324"></p> <h3 id="多入口"><a href="#多入口" class="header-anchor">#</a> 多入口</h3> <p><a href="https://cn.vitejs.dev/guide/build.html#multi-page-app" target="_blank" rel="noopener noreferrer">https://cn.vitejs.dev/guide/build.html#multi-page-app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>如下，定义了main、nested两个入口，值是入口文件的路径</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      input<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        nested<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'nested/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>区分两个入口，对于开发没有影响。仅仅是打包时，将其作为两个入口文件</p> <p>如何做到提升性能？</p> <ul><li>当用户访问一个入口时，浏览器会根据该入口的URL加载相应的输出文件和资源。而不是加载整个项目的资源</li> <li>如果多个入口有公用的资源，用户访问过入口A，再次访问入口B会直接使用该资源的缓存来提升速度</li></ul> <h3 id="gzip压缩"><a href="#gzip压缩" class="header-anchor">#</a> gzip压缩</h3> <p>将静态资源压缩</p> <p>浏览器请求到的是压缩包，对压缩包解压后才显示出来</p> <p>观察下以前yarn build后，终端的输出</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230716210925nm20.png" alt="image-20230716210925555"></p> <p>使用vite插件：<a href="https://www.npmjs.com/package/vite-plugin-compression" target="_blank" rel="noopener noreferrer">vite-plugin-compression<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite-plugin-compression -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引入插件</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span>loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>
<span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">'vite-plugin-compression'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        build<span class="token operator">:</span><span class="token punctuation">{</span>
            minify<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
            rollupOptions<span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token string">&quot;output&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token string">&quot;manualChunks&quot;</span><span class="token operator">:</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//分包优化</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">return</span> <span class="token string">'vendor'</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          		<span class="token comment">//使用压缩插件。插件默认压缩 '/\.(js|mjs|json|css|html)$/i'</span>
              <span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>执行打包 yarn build</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230716211320azd20.png" alt="image-20230716211320701"></p> <p>dist目录下，给打包后的js文件，都生成一个.gz压缩包</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230716211522vcx20.png" alt="image-20230716211522129"></p> <p>nginx部署配置</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># '~*'表示不区分大小写，'~'表示区分大小写，'\.'是对点的转义，'\.js$'表示以.js为结尾的请求</span>
<span class="token directive"><span class="token keyword">location</span> /assets/~*\.js$</span> <span class="token punctuation">{</span> 
  <span class="token directive"><span class="token keyword">gzip_static</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>  <span class="token comment">#启用了 Nginx 的静态文件压缩功能</span>
  <span class="token directive"><span class="token keyword">gzip_types</span> application/javascript</span><span class="token punctuation">;</span>  <span class="token comment">#指定了要进行压缩的文件类型为 JavaScript 文件</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当请求js文件时，Nginx 会检查是否存在同名的 <code>.gz</code> 文件，并返回压缩版本的文件。如果没有找到压缩文件，则会返回未压缩的文件。</p> <p>同时，设置响应头<code>content-encoding:gzip</code>，提示浏览器收到结果后解压。注意：浏览器解压也会损耗一定时间，所以通常只有文件过大时我们才会启用压缩</p> <h3 id="动态导入"><a href="#动态导入" class="header-anchor">#</a> 动态导入</h3> <p>动态导入是ES6的特性，Vite可以利用该特性实现代码分割，等到需要某个模块时，再动态下载</p> <p>例子：</p> <p>main.ts 引入图片</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> pic <span class="token keyword">from</span> <span class="token string">'./test-pic.png'</span>
<span class="token keyword">const</span> img<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src<span class="token operator">=</span>pic
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>vite.config.ts</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">,</span>loadEnv<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>
<span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">'vite-plugin-compression'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span>mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        build<span class="token operator">:</span><span class="token punctuation">{</span>
            assetsInlineLimit<span class="token operator">:</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token comment">//单位B</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ts检查插件</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>打包yarn build，这里使用的图片小于4000B（assetsInlineLimit配置），则会转为base64放入js文件中，导致文件体积非常大</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230716221026mngfd20.png" alt="image-20230716221026507"></p> <p><strong>动态导入</strong></p> <p>import(xxx)函数返回值是一个Promise对象，所以可以用then接收返回值</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./test-pic.png'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>pic<span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//返回值是一个Module对象</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pic<span class="token punctuation">)</span>
    <span class="token keyword">const</span> img<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>src<span class="token operator">=</span>pic<span class="token punctuation">.</span>default <span class="token comment">//default属性是动态导入的资源</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行打包yarn build。动态导入的内容会被单独打包成一个文件，当使用时再去动态加载</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230716222216asddwq20.png" alt="image-20230716222216463"></p> <p>这种动态导入实际上，一般用在<strong>动态组件</strong>。下面是Vue的router.js文件。其中的component字段就是使用动态导入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/login.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'index'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../layout/index.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/index.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'my'</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'my'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/my.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  base<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_PATH_NAME</span><span class="token punctuation">,</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>webpack动态导入的原理</strong></p> <p>Vite中动态导入利用的是ES6语法，需要浏览器原生支持该语法。而webpack则是自己实现动态导入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      	<span class="token comment">//只有路由进入了path页面，e()函数创建一个script标签，将src字段设置为提前编译好的页面js文件，并插入body。然后才进入then中的逻辑加载页面js</span>
        webpack__require<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">webpack__require</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="cdn加速"><a href="#cdn加速" class="header-anchor">#</a> CDN加速</h3> <p>一般我们会将打包后的静态资源上传到CDN，这样用户可以从最近的CDN节点下载数据，加快下载速度</p> <p>前面的分包策略可以将lodash这种第三方资源打包后是单独的js文件</p> <p>这里其实，我们也可以直接使用插件将打包后的文件，替换为使用CDN地址</p> <p>使用vite插件：<a href="https://www.npmjs.com/package/vite-plugin-cdn-import" target="_blank" rel="noopener noreferrer">vite-plugin-cdn-import<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite-plugin-cdn-import -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置文件vite.config.ts</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig<span class="token punctuation">,</span> loadEnv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span>
<span class="token keyword">import</span> importToCDN <span class="token keyword">from</span> <span class="token string">'vite-plugin-cdn-import'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> command<span class="token punctuation">,</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                typescript<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            
          	<span class="token comment">//引入插件。该插件仅仅会将打包后的包替换为cdn</span>
            <span class="token function">importToCDN</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                modules<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token comment">//包名</span>
                        <span class="token keyword">var</span><span class="token operator">:</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token comment">//引入的名，例如： import _ from 'lodash'</span>
                        path<span class="token operator">:</span> <span class="token string">'https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js'</span> <span class="token comment">//将打包后中的lodash，替换为cdn地址</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>package.json增加preview脚本</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite-ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite dev&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc --noEmit &amp;&amp; vite build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;preview&quot;</span><span class="token operator">:</span><span class="token string">&quot;vite preview&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@types/lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.14.195&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^20.4.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.1.6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.4.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite-plugin-cdn-import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.3.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite-plugin-checker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.6.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite-plugin-compression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.5.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.21&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>yarn preview 预览打包后的项目。我们会发现script中使用CDN</p> <p><img src="https://cdn.jsdelivr.net/gh/zyzylifi/blog-picture/images/20230717004419vffg20.png" alt="image-20230717004418766"></p> <p><strong>补充</strong>：</p> <p>这里的插件仅仅是帮助我们将npm包替换为指定的CDN</p> <p>目前，我们公司内部使用内部部署平台时，可以指定编译脚本，我们实现了一个工具来将打包后的assets文件整体上传CDN，并用项目名创建一个目录放在其下。将生产环境的base指定为我们的CDN地址</p> <p>项目部署在docker中的nginx下，用户其实只是访问了打包后的index.html，实际加载的文件都是从CDN加载的</p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:75px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:1;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div><div class="reco-bgm-panel" data-v-39f9e6e0><audio id="bgm" src="https://aeiherumuh10.gitee.io/blog-picture/bgm/晴天-周杰伦.mp3" data-v-39f9e6e0></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><img src="https://aeiherumuh10.gitee.io/blog-picture/bgm/JayChou.jpg" data-v-39f9e6e0></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><div class="reco-bgm-cover" style="background-image:url(https://aeiherumuh10.gitee.io/blog-picture/bgm/JayChou.jpg);" data-v-39f9e6e0><div class="mini-operation" style="display:none;" data-v-39f9e6e0><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-39f9e6e0></i></div> <div class="falut-message" style="display:none;" data-v-39f9e6e0>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><div class="info-box" data-v-39f9e6e0><i class="reco-bgm reco-bgm-music music" data-v-39f9e6e0></i>晴天</div> <div class="info-box" data-v-39f9e6e0><i class="reco-bgm reco-bgm-artist" data-v-39f9e6e0></i>周杰伦</div> <div class="reco-bgm-progress" data-v-39f9e6e0><div class="progress-bar" data-v-39f9e6e0><div class="bar" data-v-39f9e6e0></div></div></div> <div class="reco-bgm-operation" data-v-39f9e6e0><i class="reco-bgm reco-bgm-last last" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-play play" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-next next" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-39f9e6e0></i> <div class="volume-bar" data-v-39f9e6e0><div class="bar" data-v-39f9e6e0></div></div></div></div> <div class="reco-bgm-left-box" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><i class="reco-bgm reco-bgm-left" data-v-39f9e6e0></i></div></div></div></div></div>
    <script src="/zeno-blog/assets/js/app.baaaf02d.js" defer></script><script src="/zeno-blog/assets/js/3.3b039ebf.js" defer></script><script src="/zeno-blog/assets/js/1.8ae41a42.js" defer></script><script src="/zeno-blog/assets/js/28.3912919e.js" defer></script><script src="/zeno-blog/assets/js/9.54de9460.js" defer></script>
  </body>
</html>
